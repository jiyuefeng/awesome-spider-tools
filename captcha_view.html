<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å›¾ç‰‡åæ ‡æµ‹é‡å·¥å…·ï¼ˆå°ºå­æ¨¡å¼ï¼‰</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 20px;
      background: #f8f9fa;
      margin: 0;
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
      color: #212529;
    }

    .header-info {
      margin-bottom: 20px;
      font-size: 13px;
      color: #6c757d;
      line-height: 1.6;
    }

    .main-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      min-height: calc(100vh - 120px);
    }

    /* å·¦ä¾§åŒºåŸŸ - å›¾ç‰‡å±•ç¤º */
    .left-panel {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    /* å³ä¾§åŒºåŸŸ - å·¥å…·é¢æ¿ */
    .right-panel {
      flex: 1;
      display: flex;
      gap: 20px;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }

    /* å³ä¾§é¢æ¿åˆ— */
    .right-column {
      flex: 1;
      min-width: 280px;
      max-width: 380px;
    }

    /* ä¸»å®¹å™¨ - åŒ…å«å°ºå­å’Œå›¾ç‰‡ */
    .ruler-container {
      position: relative;
      display: inline-block;
      background: white;
      padding: 30px 0 0 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* é¡¶éƒ¨æ¨ªå‘å°ºå­ */
    .ruler-top {
      position: absolute;
      top: 0;
      left: 30px;
      height: 30px;
      background: #e9ecef;
      border-bottom: 2px solid #495057;
      display: flex;
      font-size: 10px;
      color: #495057;
    }

    /* å·¦ä¾§çºµå‘å°ºå­ */
    .ruler-left {
      position: absolute;
      left: 0;
      top: 30px;
      width: 30px;
      background: #e9ecef;
      border-right: 2px solid #495057;
      font-size: 10px;
      color: #495057;
    }

    /* å·¦ä¸Šè§’çš„æ–¹å— */
    .ruler-corner {
      position: absolute;
      left: 0;
      top: 0;
      width: 30px;
      height: 30px;
      background: #dee2e6;
      border-right: 2px solid #495057;
      border-bottom: 2px solid #495057;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: #495057;
    }

    /* å°ºå­åˆ»åº¦çº¿ */
    .ruler-mark {
      position: absolute;
      background: #495057;
    }

    .ruler-mark.major {
      background: #212529;
    }

    /* å°ºå­æ•°å­— */
    .ruler-number {
      position: absolute;
      font-size: 9px;
      color: #495057;
      user-select: none;
    }

    /* å›¾ç‰‡å®¹å™¨ */
    .img-wrapper {
      position: relative;
      display: inline-block;
    }

    .img-wrapper img {
      display: block;
      max-width: 600px;
      height: auto;
      cursor: crosshair;
    }

    /* åå­—çº¿ - å®æ—¶è·Ÿéšé¼ æ ‡ */
    .crosshair-vertical,
    .crosshair-horizontal {
      position: absolute;
      background: rgba(255, 0, 0, 0.5);
      pointer-events: none;
      display: none;
    }

    .crosshair-vertical {
      width: 1px;
      height: 100%;
      top: 0;
    }

    .crosshair-horizontal {
      width: 100%;
      height: 1px;
      left: 0;
    }

    /* å®æ—¶åæ ‡æ˜¾ç¤ºæ¡† */
    .coord-tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      pointer-events: none;
      display: none;
      white-space: nowrap;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* ç‚¹å‡»æ ‡è®°å°åœ†ç‚¹ */
    .marker {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ff4444;
      border: 2px solid white;
      box-shadow: 0 0 4px rgba(0,0,0,0.5);
      transform: translate(-50%, -50%);
      pointer-events: none;
      display: none;
    }

    /* ä¿¡æ¯é¢æ¿ */
    .info {
      min-width: 300px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .info h3 {
      margin-top: 0;
      color: #212529;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }

    .info-item {
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
    }

    .info-label {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .info-value {
      font-size: 11px;
      color: #495057;
      margin-top: 3px;
    }

    code {
      background: #fff;
      padding: 4px 8px;
      border-radius: 3px;
      border: 1px solid #dee2e6;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #007bff;
      font-weight: bold;
      display: inline-block;
    }

    .current-coord {
      background: #e7f3ff;
      border-left: 3px solid #007bff;
    }

    .clicked-coord {
      background: #ffe7e7;
      border-left: 3px solid #ff4444;
    }

    .original-coord {
      background: #e8f5e9;
      border-left: 3px solid #28a745;
    }

    .size-info {
      background: #fff3cd;
      border-left: 3px solid #ffc107;
    }

    /* è£å‰ªåŒºåŸŸçŸ©å½¢æ¡† */
    .crop-area-rect {
      position: absolute;
      border: 2px dashed #ff9800;
      background: rgba(255, 152, 0, 0.1);
      pointer-events: none;
      display: none;
    }

    /* æ‰“ç å¹³å°è¿”å›çš„æ ‡è®°ç‚¹ */
    .captcha-point {
      position: absolute;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #00ff00;
      border: 3px solid #fff;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.8), 0 0 20px rgba(0, 255, 0, 0.5);
      transform: translate(-50%, -50%);
      pointer-events: none;
      animation: blink 1s ease-in-out infinite;
      z-index: 50;
    }

    /* ç‚¹çš„åºå·æ ‡ç­¾ */
    .captcha-point-label {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: #00ff00;
      color: #000;
      font-weight: bold;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 3px;
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* é—ªçƒåŠ¨ç”» */
    @keyframes blink {
      0%, 100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      50% {
        opacity: 0.3;
        transform: translate(-50%, -50%) scale(1.2);
      }
    }

    /* éªŒè¯å·¥å…·é¢æ¿ */
    .verification-panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .verification-panel h3 {
      margin-top: 0;
      color: #212529;
      border-bottom: 2px solid #28a745;
      padding-bottom: 10px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      font-size: 13px;
      color: #495057;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Courier New', monospace;
      box-sizing: border-box;
    }

    .input-group input:focus {
      outline: none;
      border-color: #28a745;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }

    .input-group .hint {
      font-size: 11px;
      color: #6c757d;
      margin-top: 3px;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #28a745;
      color: white;
    }

    .btn-primary:hover {
      background: #218838;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .verification-result {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      display: none;
    }

    .verification-result.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .verification-result.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    /* å›¾ç‰‡åŠ è½½é¢æ¿ */
    .image-loader-panel {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .image-loader-panel h3 {
      margin: 0 0 15px 0;
      color: #212529;
      font-size: 16px;
      border-bottom: 2px solid #17a2b8;
      padding-bottom: 8px;
    }

    .loader-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .loader-controls input[type="text"] {
      flex: 1;
      min-width: 300px;
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Courier New', monospace;
    }

    .loader-controls input[type="text"]:focus {
      outline: none;
      border-color: #17a2b8;
      box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
    }

    .loader-controls input[type="file"] {
      display: none;
    }

    .btn-info {
      background: #17a2b8;
      color: white;
    }

    .btn-info:hover {
      background: #138496;
    }

    .btn-file-label {
      padding: 10px 20px;
      background: #6c757d;
      color: white;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-block;
    }

    .btn-file-label:hover {
      background: #5a6268;
    }

    .loader-hint {
      font-size: 11px;
      color: #6c757d;
      width: 100%;
      margin-top: 5px;
    }

    .image-info {
      margin-top: 10px;
      padding: 8px 12px;
      background: #e7f3ff;
      border-left: 3px solid #17a2b8;
      border-radius: 4px;
      font-size: 12px;
      color: #0c5460;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ å›¾ç‰‡åæ ‡æµ‹é‡å·¥å…·ï¼ˆå°ºå­æ¨¡å¼ï¼‰</h1>
  <div class="header-info">
    <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
    ç§»åŠ¨é¼ æ ‡å®æ—¶æ˜¾ç¤ºåæ ‡å’Œåå­—çº¿ â€¢ ç‚¹å‡»å›¾ç‰‡æ ‡è®°åæ ‡ç‚¹ â€¢ åæ ‡ç³»ä»å›¾ç‰‡å·¦ä¸Šè§’ (0, 0) å¼€å§‹
  </div>

  <!-- å›¾ç‰‡åŠ è½½é¢æ¿ -->
  <div class="image-loader-panel">
    <h3>ğŸ–¼ï¸ å›¾ç‰‡åŠ è½½</h3>
    <div class="loader-controls">
      <input 
        type="text" 
        id="imageUrlInput" 
        placeholder="è¾“å…¥å›¾ç‰‡URLæˆ–æœ¬åœ°è·¯å¾„ï¼Œä¾‹å¦‚: https://example.com/image.png æˆ– ./screen.png"
        value="./screen.png"
      />
      <button class="btn btn-info" onclick="loadImageFromUrl()">
        ğŸ“¥ åŠ è½½å›¾ç‰‡
      </button>
      <label for="imageFileInput" class="btn-file-label">
        ğŸ“ é€‰æ‹©æœ¬åœ°æ–‡ä»¶
      </label>
      <input 
        type="file" 
        id="imageFileInput" 
        accept="image/*"
        onchange="loadImageFromFile(this)"
      />
    </div>
    <div class="loader-hint">
      æ”¯æŒ JPGã€PNGã€GIFã€WebP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼ â€¢ ç½‘ç»œå›¾ç‰‡éœ€è¦æ”¯æŒè·¨åŸŸè®¿é—®
    </div>
    <div class="image-info" id="imageInfo"></div>
  </div>

  <div class="main-container">
    <!-- å·¦ä¾§ï¼šå›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
    <div class="left-panel">
      <!-- å°ºå­å®¹å™¨ -->
      <div class="ruler-container" id="rulerContainer">
      <!-- å·¦ä¸Šè§’æ–¹å— -->
      <div class="ruler-corner">0</div>
      
      <!-- é¡¶éƒ¨æ¨ªå‘å°ºå­ -->
      <div class="ruler-top" id="rulerTop"></div>
      
      <!-- å·¦ä¾§çºµå‘å°ºå­ -->
      <div class="ruler-left" id="rulerLeft"></div>
      
      <!-- å›¾ç‰‡å®¹å™¨ -->
      <div class="img-wrapper" id="imgWrapper">
        <!-- æ›¿æ¢ä¸ºä½ çš„éªŒè¯ç å›¾ç‰‡åœ°å€ -->
        <img id="targetImg" src="./screen.png" alt="demo" />
        
        <!-- åå­—çº¿ -->
        <div class="crosshair-vertical" id="crosshairV"></div>
        <div class="crosshair-horizontal" id="crosshairH"></div>
        
        <!-- å®æ—¶åæ ‡æç¤ºæ¡† -->
        <div class="coord-tooltip" id="coordTooltip">X: 0, Y: 0</div>
        
        <!-- ç‚¹å‡»æ ‡è®° -->
        <div class="marker" id="marker"></div>
      </div>
    </div>
    </div>

    <!-- å³ä¾§ï¼šå·¥å…·é¢æ¿ -->
    <div class="right-panel">
      <!-- å·¦åˆ—ï¼šéªŒè¯å·¥å…·é¢æ¿ -->
      <div class="right-column">
        <div class="verification-panel">
          <h3>ğŸ¯ æ‰“ç å¹³å°åæ ‡éªŒè¯</h3>
          
          <div class="input-group">
            <label for="cropAreaInput">è£å‰ªåŒºåŸŸ (left, upper, right, lower)</label>
            <input 
              type="text" 
              id="cropAreaInput" 
              placeholder="90, 550, 810, 1140"
              value="90, 550, 810, 1140"
            />
            <div class="hint">æ ¼å¼ï¼šå·¦, ä¸Š, å³, ä¸‹ï¼ˆé€—å·åˆ†éš”ï¼‰</div>
          </div>

          <div class="input-group">
            <label for="captchaPointsInput">æ‰“ç å¹³å°è¿”å›åæ ‡</label>
            <input 
              type="text" 
              id="captchaPointsInput" 
              placeholder="497,259|597,374|244,327"
              value=""
            />
            <div class="hint">æ ¼å¼ï¼šx,y|x,y|x,yï¼ˆç”¨ | åˆ†éš”ï¼‰</div>
          </div>

          <div class="btn-group">
            <button class="btn btn-primary" onclick="showCaptchaPoints()">
              âœ¨ æ˜¾ç¤ºæ ‡è®°
            </button>
            <button class="btn btn-secondary" onclick="clearCaptchaPoints()">
              ğŸ—‘ï¸ æ¸…é™¤
            </button>
          </div>

          <div class="verification-result" id="verificationResult"></div>
        </div>
      </div>

      <!-- å³åˆ—ï¼šåæ ‡ä¿¡æ¯é¢æ¿ -->
      <div class="right-column">
        <div class="info">
          <h3>ğŸ“Š åæ ‡ä¿¡æ¯</h3>
      
      <div class="info-item size-info">
        <div class="info-label">ğŸ“ å›¾ç‰‡åŸå§‹å°ºå¯¸</div>
        <code id="originalSize">åŠ è½½ä¸­...</code>
        <div class="info-value">å›¾ç‰‡æ–‡ä»¶çš„çœŸå®å°ºå¯¸</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">ğŸ–¥ï¸ å›¾ç‰‡æ¸²æŸ“å°ºå¯¸</div>
        <code id="displaySize">åŠ è½½ä¸­...</code>
        <div class="info-value">æµè§ˆå™¨ä¸­çš„æ˜¾ç¤ºå°ºå¯¸</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">ğŸ“ ç¼©æ”¾æ¯”ä¾‹</div>
        <code id="scaleRatio">-</code>
        <div class="info-value">åŸå§‹å°ºå¯¸ Ã· æ¸²æŸ“å°ºå¯¸</div>
      </div>
      
      <div class="info-item current-coord">
        <div class="info-label">ğŸ–±ï¸ å½“å‰é¼ æ ‡åæ ‡ï¼ˆæ¸²æŸ“å°ºå¯¸ï¼‰</div>
        <code id="browserCoord">ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹</code>
      </div>
      
      <div class="info-item original-coord">
        <div class="info-label">âœ¨ å½“å‰é¼ æ ‡åæ ‡ï¼ˆåŸå§‹å°ºå¯¸ï¼‰</div>
        <code id="originalCoord">ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹</code>
        <div class="info-value">æŒ‰åŸå§‹å°ºå¯¸è®¡ç®—çš„åæ ‡</div>
      </div>
      
      <div class="info-item clicked-coord">
        <div class="info-label">ğŸ“ æœ€åç‚¹å‡»åæ ‡ï¼ˆæ¸²æŸ“å°ºå¯¸ï¼‰</div>
        <code id="clickedCoord">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹</code>
      </div>
      
      <div class="info-item original-coord">
        <div class="info-label">ğŸ“ æœ€åç‚¹å‡»åæ ‡ï¼ˆåŸå§‹å°ºå¯¸ï¼‰</div>
        <code id="clickedOriginalCoord">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹</code>
        <div class="info-value">æŒ‰åŸå§‹å°ºå¯¸è®¡ç®—çš„åæ ‡</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">ğŸ“± æ˜ å°„åˆ°æ‰‹æœºåæ ‡ç³»ï¼ˆ900 Ã— 1600ï¼‰</div>
        <code id="phoneCoord">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹</code>
        <div class="info-value">åŸºäºåŸå§‹å°ºå¯¸æ˜ å°„</div>
      </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ç›®æ ‡æ‰‹æœºåæ ‡ç³»åˆ†è¾¨ç‡
    const PHONE_WIDTH = 900;
    const PHONE_HEIGHT = 1600;

    // è·å–DOMå…ƒç´ 
    const img = document.getElementById("targetImg");
    const wrapper = document.getElementById("imgWrapper");
    const marker = document.getElementById("marker");
    const crosshairV = document.getElementById("crosshairV");
    const crosshairH = document.getElementById("crosshairH");
    const coordTooltip = document.getElementById("coordTooltip");
    const rulerTop = document.getElementById("rulerTop");
    const rulerLeft = document.getElementById("rulerLeft");

    const originalSizeEl = document.getElementById("originalSize");
    const displaySizeEl = document.getElementById("displaySize");
    const scaleRatioEl = document.getElementById("scaleRatio");
    const browserCoordEl = document.getElementById("browserCoord");
    const originalCoordEl = document.getElementById("originalCoord");
    const clickedCoordEl = document.getElementById("clickedCoord");
    const clickedOriginalCoordEl = document.getElementById("clickedOriginalCoord");
    const phoneCoordEl = document.getElementById("phoneCoord");

    // ç»˜åˆ¶å°ºå­åˆ»åº¦ï¼ˆåŸºäºåŸå§‹å°ºå¯¸ï¼‰
    function drawRulers() {
      const rect = img.getBoundingClientRect();
      const displayWidth = Math.round(rect.width);
      const displayHeight = Math.round(rect.height);
      
      // è·å–å›¾ç‰‡åŸå§‹å°ºå¯¸
      const originalWidth = img.naturalWidth;
      const originalHeight = img.naturalHeight;
      
      // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
      const scaleX = originalWidth / displayWidth;
      const scaleY = originalHeight / displayHeight;

      // æ¸…ç©ºå°ºå­
      rulerTop.innerHTML = '';
      rulerLeft.innerHTML = '';

      // è®¾ç½®å°ºå­å°ºå¯¸ï¼ˆæŒ‰æ¸²æŸ“å°ºå¯¸ï¼‰
      rulerTop.style.width = displayWidth + 'px';
      rulerLeft.style.height = displayHeight + 'px';

      // è®¡ç®—åˆ»åº¦é—´éš”ï¼ˆåŸºäºåŸå§‹å°ºå¯¸ï¼‰
      // æ ¹æ®åŸå§‹å®½åº¦é€‰æ‹©åˆé€‚çš„åˆ»åº¦é—´éš”
      let originalStepX = 50;
      if (originalWidth > 2000) {
        originalStepX = 200;
      } else if (originalWidth > 1000) {
        originalStepX = 100;
      }
      
      let originalStepY = 50;
      if (originalHeight > 2000) {
        originalStepY = 200;
      } else if (originalHeight > 1000) {
        originalStepY = 100;
      }

      // ç»˜åˆ¶é¡¶éƒ¨æ¨ªå‘å°ºå­ï¼ˆæ˜¾ç¤ºåŸå§‹å°ºå¯¸åˆ»åº¦ï¼‰
      const displayStepX = originalStepX / scaleX; // è½¬æ¢ä¸ºæ˜¾ç¤ºå°ºå¯¸ä¸Šçš„é—´éš”
      for (let i = 0; i <= displayWidth; i += displayStepX) {
        const originalValue = Math.round(i * scaleX); // å¯¹åº”çš„åŸå§‹å°ºå¯¸å€¼
        const isMajor = originalValue % (originalStepX * 2) === 0;
        
        // åˆ»åº¦çº¿
        const mark = document.createElement('div');
        mark.className = 'ruler-mark' + (isMajor ? ' major' : '');
        mark.style.left = i + 'px';
        mark.style.top = isMajor ? '0' : '5px';
        mark.style.width = '1px';
        mark.style.height = isMajor ? '30px' : '10px';
        rulerTop.appendChild(mark);
        
        // åˆ»åº¦æ•°å­—ï¼ˆæ˜¾ç¤ºåŸå§‹å°ºå¯¸å€¼ï¼‰
        if (isMajor && originalValue > 0) {
          const num = document.createElement('div');
          num.className = 'ruler-number';
          num.textContent = originalValue;
          num.style.left = (i + 2) + 'px';
          num.style.top = '2px';
          rulerTop.appendChild(num);
        }
      }

      // ç»˜åˆ¶å·¦ä¾§çºµå‘å°ºå­ï¼ˆæ˜¾ç¤ºåŸå§‹å°ºå¯¸åˆ»åº¦ï¼‰
      const displayStepY = originalStepY / scaleY;
      for (let i = 0; i <= displayHeight; i += displayStepY) {
        const originalValue = Math.round(i * scaleY);
        const isMajor = originalValue % (originalStepY * 2) === 0;
        
        // åˆ»åº¦çº¿
        const mark = document.createElement('div');
        mark.className = 'ruler-mark' + (isMajor ? ' major' : '');
        mark.style.top = i + 'px';
        mark.style.left = isMajor ? '0' : '20px';
        mark.style.height = '1px';
        mark.style.width = isMajor ? '30px' : '10px';
        rulerLeft.appendChild(mark);
        
        // åˆ»åº¦æ•°å­—ï¼ˆæ˜¾ç¤ºåŸå§‹å°ºå¯¸å€¼ï¼‰
        if (isMajor && originalValue > 0) {
          const num = document.createElement('div');
          num.className = 'ruler-number';
          num.textContent = originalValue;
          num.style.top = (i + 2) + 'px';
          num.style.left = '2px';
          num.style.transform = 'rotate(-90deg)';
          num.style.transformOrigin = 'left top';
          rulerLeft.appendChild(num);
        }
      }
    }

    // æ›´æ–°å°ºå¯¸ä¿¡æ¯
    function updateSizeInfo() {
      const rect = img.getBoundingClientRect();
      const displayWidth = Math.round(rect.width);
      const displayHeight = Math.round(rect.height);
      const originalWidth = img.naturalWidth;
      const originalHeight = img.naturalHeight;
      
      // æ›´æ–°æ˜¾ç¤º
      originalSizeEl.textContent = `${originalWidth} Ã— ${originalHeight} px`;
      displaySizeEl.textContent = `${displayWidth} Ã— ${displayHeight} px`;
      
      const scaleX = (originalWidth / displayWidth).toFixed(2);
      const scaleY = (originalHeight / displayHeight).toFixed(2);
      scaleRatioEl.textContent = `${scaleX} Ã— ${scaleY}`;
    }

    // å›¾ç‰‡åŠ è½½å®Œåï¼Œæ˜¾ç¤ºå°ºå¯¸å¹¶ç»˜åˆ¶å°ºå­
    img.addEventListener("load", () => {
      updateSizeInfo();
      drawRulers();
    });

    // å¦‚æœå›¾ç‰‡å·²ç»åŠ è½½å®Œæˆï¼ˆç¼“å­˜ï¼‰
    if (img.complete) {
      updateSizeInfo();
      drawRulers();
    }

    // é¼ æ ‡ç§»åŠ¨ - æ˜¾ç¤ºå®æ—¶åæ ‡å’Œåå­—çº¿
    wrapper.addEventListener("mousemove", (event) => {
      const rect = img.getBoundingClientRect();
      const wrapperRect = wrapper.getBoundingClientRect();
      
      // è®¡ç®—ç›¸å¯¹å›¾ç‰‡çš„åæ ‡ï¼ˆæ¸²æŸ“å°ºå¯¸ï¼‰
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      // æ£€æŸ¥æ˜¯å¦åœ¨å›¾ç‰‡èŒƒå›´å†…
      if (x >= 0 && y >= 0 && x <= rect.width && y <= rect.height) {
        // æ˜¾ç¤ºåå­—çº¿
        crosshairV.style.display = 'block';
        crosshairH.style.display = 'block';
        coordTooltip.style.display = 'block';

        // æ›´æ–°åå­—çº¿ä½ç½®ï¼ˆç›¸å¯¹wrapperï¼‰
        const offsetX = event.clientX - wrapperRect.left;
        const offsetY = event.clientY - wrapperRect.top;
        
        crosshairV.style.left = offsetX + 'px';
        crosshairH.style.top = offsetY + 'px';

        // è®¡ç®—åŸå§‹å°ºå¯¸åæ ‡
        const scaleX = img.naturalWidth / rect.width;
        const scaleY = img.naturalHeight / rect.height;
        const xOriginal = x * scaleX;
        const yOriginal = y * scaleY;

        // æ›´æ–°åæ ‡æç¤ºæ¡†ï¼ˆæ˜¾ç¤ºåŸå§‹å°ºå¯¸åæ ‡ï¼‰
        coordTooltip.textContent = `åŸå§‹: ${Math.round(xOriginal)}, ${Math.round(yOriginal)}`;
        coordTooltip.style.left = (offsetX + 15) + 'px';
        coordTooltip.style.top = (offsetY + 15) + 'px';

        // å¦‚æœå¤ªé å³æˆ–é ä¸‹ï¼Œè°ƒæ•´æç¤ºæ¡†ä½ç½®
        if (offsetX > rect.width - 120) {
          coordTooltip.style.left = (offsetX - 125) + 'px';
        }
        if (offsetY > rect.height - 40) {
          coordTooltip.style.top = (offsetY - 35) + 'px';
        }

        // æ›´æ–°å®æ—¶åæ ‡æ˜¾ç¤º
        browserCoordEl.textContent = `X: ${Math.round(x)}, Y: ${Math.round(y)}`;
        originalCoordEl.textContent = `X: ${Math.round(xOriginal)}, Y: ${Math.round(yOriginal)}`;
      } else {
        // é¼ æ ‡ç§»å‡ºå›¾ç‰‡åŒºåŸŸï¼Œéšè—åå­—çº¿
        crosshairV.style.display = 'none';
        crosshairH.style.display = 'none';
        coordTooltip.style.display = 'none';
      }
    });

    // é¼ æ ‡ç¦»å¼€ - éšè—åå­—çº¿
    wrapper.addEventListener("mouseleave", () => {
      crosshairV.style.display = 'none';
      crosshairH.style.display = 'none';
      coordTooltip.style.display = 'none';
      browserCoordEl.textContent = 'ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹';
      originalCoordEl.textContent = 'ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹';
    });

    // ç‚¹å‡»äº‹ä»¶ - æ ‡è®°åæ ‡ç‚¹
    wrapper.addEventListener("click", (event) => {
      const rect = img.getBoundingClientRect();
      const wrapperRect = wrapper.getBoundingClientRect();

      // â‘  è®¡ç®—æ¸²æŸ“åæ ‡ï¼ˆç›¸å¯¹å›¾ç‰‡å·¦ä¸Šè§’ï¼ŒåŸºäºæ˜¾ç¤ºå°ºå¯¸ï¼‰
      const xBrowser = event.clientX - rect.left;
      const yBrowser = event.clientY - rect.top;

      // é˜²æ­¢ç‚¹å‡»åˆ°è¾¹æ¡†ç©ºç™½åŒºåŸŸ
      if (xBrowser < 0 || yBrowser < 0 || xBrowser > rect.width || yBrowser > rect.height) {
        return;
      }

      // â‘¡ è®¡ç®—åŸå§‹å°ºå¯¸åæ ‡
      const scaleToOriginal = img.naturalWidth / rect.width;
      const scaleToOriginalY = img.naturalHeight / rect.height;
      const xOriginal = xBrowser * scaleToOriginal;
      const yOriginal = yBrowser * scaleToOriginalY;

      // â‘¢ æŒ‰åŸå§‹å°ºå¯¸æ¯”ä¾‹æ˜ å°„åˆ°æ‰‹æœºåæ ‡ç³»ï¼ˆ900 Ã— 1600ï¼‰
      const scaleToPhone = PHONE_WIDTH / img.naturalWidth;
      const scaleToPhoneY = PHONE_HEIGHT / img.naturalHeight;
      const xPhone = xOriginal * scaleToPhone;
      const yPhone = yOriginal * scaleToPhoneY;

      // æ˜¾ç¤ºå„ç§åæ ‡
      clickedCoordEl.textContent = `X: ${Math.round(xBrowser)}, Y: ${Math.round(yBrowser)}`;
      clickedOriginalCoordEl.textContent = `X: ${Math.round(xOriginal)}, Y: ${Math.round(yOriginal)}`;
      phoneCoordEl.textContent = `X: ${Math.round(xPhone)}, Y: ${Math.round(yPhone)}`;

      // ç§»åŠ¨å°çº¢ç‚¹åˆ°ç‚¹å‡»ä½ç½®
      const offsetX = event.clientX - wrapperRect.left;
      const offsetY = event.clientY - wrapperRect.top;

      marker.style.left = offsetX + "px";
      marker.style.top = offsetY + "px";
      marker.style.display = "block";

      console.log('ç‚¹å‡»åæ ‡:', {
        æ¸²æŸ“å°ºå¯¸: { x: Math.round(xBrowser), y: Math.round(yBrowser) },
        åŸå§‹å°ºå¯¸: { x: Math.round(xOriginal), y: Math.round(yOriginal) },
        æ‰‹æœºåæ ‡: { x: Math.round(xPhone), y: Math.round(yPhone) }
      });
    });

    // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°ç»˜åˆ¶å°ºå­
    window.addEventListener('resize', () => {
      drawRulers();
    });

    // ==================== æ‰“ç å¹³å°åæ ‡éªŒè¯åŠŸèƒ½ ====================

    // æ˜¾ç¤ºæ‰“ç å¹³å°è¿”å›çš„åæ ‡ç‚¹
    function showCaptchaPoints() {
      // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
      clearCaptchaPoints();

      // è·å–è¾“å…¥å€¼
      const cropAreaInput = document.getElementById('cropAreaInput').value.trim();
      const captchaPointsInput = document.getElementById('captchaPointsInput').value.trim();
      const resultEl = document.getElementById('verificationResult');

      // éªŒè¯è¾“å…¥
      if (!cropAreaInput || !captchaPointsInput) {
        showResult('è¯·å¡«å†™è£å‰ªåŒºåŸŸå’Œæ‰“ç å¹³å°åæ ‡ï¼', 'error');
        return;
      }

      try {
        // è§£æè£å‰ªåŒºåŸŸ (left, upper, right, lower)
        const cropValues = cropAreaInput.split(',').map(v => parseInt(v.trim()));
        if (cropValues.length !== 4 || cropValues.some(isNaN)) {
          throw new Error('è£å‰ªåŒºåŸŸæ ¼å¼é”™è¯¯ï¼åº”ä¸º 4 ä¸ªæ•°å­—ï¼Œç”¨é€—å·åˆ†éš”');
        }
        const [left, upper, right, lower] = cropValues;
        const cropWidth = right - left;
        const cropHeight = lower - upper;

        // è§£ææ‰“ç å¹³å°åæ ‡ (x,y|x,y|x,y)
        const pointStrings = captchaPointsInput.split('|').map(s => s.trim()).filter(s => s);
        if (pointStrings.length === 0) {
          throw new Error('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªåæ ‡ç‚¹ï¼');
        }

        const points = [];
        for (const pointStr of pointStrings) {
          const coords = pointStr.split(',').map(v => parseInt(v.trim()));
          if (coords.length !== 2 || coords.some(isNaN)) {
            throw new Error(`åæ ‡æ ¼å¼é”™è¯¯: ${pointStr}`);
          }
          points.push({ x: coords[0], y: coords[1] });
        }

        // åœ¨å›¾ç‰‡ä¸Šæ˜¾ç¤ºè£å‰ªåŒºåŸŸ
        const rect = img.getBoundingClientRect();
        const scaleX = rect.width / img.naturalWidth;
        const scaleY = rect.height / img.naturalHeight;

        // ç»˜åˆ¶è£å‰ªåŒºåŸŸçŸ©å½¢
        const cropRect = document.createElement('div');
        cropRect.className = 'crop-area-rect';
        cropRect.style.left = (left * scaleX) + 'px';
        cropRect.style.top = (upper * scaleY) + 'px';
        cropRect.style.width = (cropWidth * scaleX) + 'px';
        cropRect.style.height = (cropHeight * scaleY) + 'px';
        cropRect.style.display = 'block';
        wrapper.appendChild(cropRect);

        // æ˜¾ç¤ºæ¯ä¸ªæ‰“ç å¹³å°è¿”å›çš„ç‚¹
        const pointsInfo = [];
        points.forEach((point, index) => {
          // æ‰“ç å¹³å°åæ ‡æ˜¯ç›¸å¯¹äºè£å‰ªåçš„å›¾ç‰‡
          // è½¬æ¢ä¸ºåŸå§‹å›¾ç‰‡åæ ‡ï¼šåŸå§‹åæ ‡ = è£å‰ªèµ·ç‚¹ + æ‰“ç åæ ‡
          const originalX = left + point.x;
          const originalY = upper + point.y;

          // è½¬æ¢ä¸ºæ¸²æŸ“åæ ‡
          const displayX = originalX * scaleX;
          const displayY = originalY * scaleY;

          // åˆ›å»ºæ ‡è®°ç‚¹
          const pointEl = document.createElement('div');
          pointEl.className = 'captcha-point';
          pointEl.style.left = displayX + 'px';
          pointEl.style.top = displayY + 'px';
          pointEl.style.display = 'block';

          // æ·»åŠ åºå·æ ‡ç­¾
          const label = document.createElement('div');
          label.className = 'captcha-point-label';
          label.textContent = `#${index + 1} (${point.x},${point.y})`;
          pointEl.appendChild(label);

          wrapper.appendChild(pointEl);

          pointsInfo.push({
            index: index + 1,
            captcha: `(${point.x}, ${point.y})`,
            original: `(${originalX}, ${originalY})`
          });

          console.log(`ç‚¹ #${index + 1}:`, {
            æ‰“ç å¹³å°åæ ‡: `(${point.x}, ${point.y})`,
            ç›¸å¯¹è£å‰ªåŒºåŸŸ: `ç›¸å¯¹äº (${left}, ${upper})`,
            åŸå§‹å›¾ç‰‡åæ ‡: `(${originalX}, ${originalY})`,
            æ¸²æŸ“åæ ‡: `(${Math.round(displayX)}, ${Math.round(displayY)})`
          });
        });

        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        let resultText = `âœ… å·²æ ‡è®° ${points.length} ä¸ªç‚¹<br>`;
        resultText += `ğŸ“¦ è£å‰ªåŒºåŸŸ: (${left}, ${upper}) â†’ (${right}, ${lower})<br>`;
        resultText += `ğŸ“ è£å‰ªå°ºå¯¸: ${cropWidth} Ã— ${cropHeight}<br><br>`;
        pointsInfo.forEach(p => {
          resultText += `#${p.index} æ‰“ç : ${p.captcha} â†’ åŸå§‹: ${p.original}<br>`;
        });
        showResult(resultText, 'success');

      } catch (error) {
        showResult('âŒ ' + error.message, 'error');
        console.error('è§£æé”™è¯¯:', error);
      }
    }

    // æ¸…é™¤æ‰“ç å¹³å°æ ‡è®°
    function clearCaptchaPoints() {
      // ç§»é™¤æ‰€æœ‰æ‰“ç ç‚¹æ ‡è®°
      const points = wrapper.querySelectorAll('.captcha-point');
      points.forEach(p => p.remove());

      // ç§»é™¤è£å‰ªåŒºåŸŸçŸ©å½¢
      const cropRects = wrapper.querySelectorAll('.crop-area-rect');
      cropRects.forEach(r => r.remove());

      // æ¸…é™¤ç»“æœæç¤º
      const resultEl = document.getElementById('verificationResult');
      resultEl.style.display = 'none';
    }

    // æ˜¾ç¤ºç»“æœä¿¡æ¯
    function showResult(message, type) {
      const resultEl = document.getElementById('verificationResult');
      resultEl.innerHTML = message;
      resultEl.className = 'verification-result ' + (type === 'error' ? 'info' : 'success');
      resultEl.style.display = 'block';
    }

    // ==================== å›¾ç‰‡åŠ è½½åŠŸèƒ½ ====================

    // ä»URLåŠ è½½å›¾ç‰‡
    function loadImageFromUrl() {
      const imageUrl = document.getElementById('imageUrlInput').value.trim();
      const imageInfoEl = document.getElementById('imageInfo');
      
      if (!imageUrl) {
        showImageInfo('âŒ è¯·è¾“å…¥å›¾ç‰‡URLæˆ–è·¯å¾„ï¼', 'error');
        return;
      }

      // æ˜¾ç¤ºåŠ è½½ä¸­
      showImageInfo('â³ æ­£åœ¨åŠ è½½å›¾ç‰‡...', 'loading');
      
      // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
      clearCaptchaPoints();
      marker.style.display = 'none';
      
      // é‡ç½®åæ ‡æ˜¾ç¤º
      resetCoordinates();
      
      // åˆ›å»ºæ–°å›¾ç‰‡å¯¹è±¡æµ‹è¯•åŠ è½½
      const testImg = new Image();
      
      testImg.onload = function() {
        // åŠ è½½æˆåŠŸï¼Œæ›´æ–°ä¸»å›¾ç‰‡
        img.src = imageUrl;
        showImageInfo(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸï¼å°ºå¯¸: ${testImg.naturalWidth} Ã— ${testImg.naturalHeight} px`, 'success');
        console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', imageUrl);
      };
      
      testImg.onerror = function() {
        showImageInfo('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®ï¼Œæˆ–å›¾ç‰‡æ˜¯å¦æ”¯æŒè·¨åŸŸè®¿é—®ã€‚', 'error');
        console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl);
      };
      
      testImg.src = imageUrl;
    }

    // ä»æœ¬åœ°æ–‡ä»¶åŠ è½½å›¾ç‰‡
    function loadImageFromFile(input) {
      const imageInfoEl = document.getElementById('imageInfo');
      
      if (!input.files || !input.files[0]) {
        return;
      }
      
      const file = input.files[0];
      
      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.type.startsWith('image/')) {
        showImageInfo('âŒ è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
        return;
      }
      
      showImageInfo('â³ æ­£åœ¨åŠ è½½æœ¬åœ°å›¾ç‰‡...', 'loading');
      
      // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
      clearCaptchaPoints();
      marker.style.display = 'none';
      
      // é‡ç½®åæ ‡æ˜¾ç¤º
      resetCoordinates();
      
      // ä½¿ç”¨FileReaderè¯»å–æ–‡ä»¶
      const reader = new FileReader();
      
      reader.onload = function(e) {
        // æ›´æ–°å›¾ç‰‡æº
        img.src = e.target.result;
        
        // æ›´æ–°è¾“å…¥æ¡†æ˜¾ç¤ºæ–‡ä»¶å
        document.getElementById('imageUrlInput').value = file.name;
        
        showImageInfo(`âœ… æœ¬åœ°å›¾ç‰‡åŠ è½½æˆåŠŸï¼æ–‡ä»¶å: ${file.name}`, 'success');
        console.log('æœ¬åœ°å›¾ç‰‡åŠ è½½æˆåŠŸ:', file.name);
      };
      
      reader.onerror = function() {
        showImageInfo('âŒ æ–‡ä»¶è¯»å–å¤±è´¥ï¼', 'error');
        console.error('æ–‡ä»¶è¯»å–å¤±è´¥');
      };
      
      reader.readAsDataURL(file);
    }

    // æ˜¾ç¤ºå›¾ç‰‡åŠ è½½ä¿¡æ¯
    function showImageInfo(message, type) {
      const imageInfoEl = document.getElementById('imageInfo');
      imageInfoEl.textContent = message;
      imageInfoEl.style.display = 'block';
      
      // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
      if (type === 'error') {
        imageInfoEl.style.background = '#f8d7da';
        imageInfoEl.style.borderLeftColor = '#dc3545';
        imageInfoEl.style.color = '#721c24';
      } else if (type === 'loading') {
        imageInfoEl.style.background = '#fff3cd';
        imageInfoEl.style.borderLeftColor = '#ffc107';
        imageInfoEl.style.color = '#856404';
      } else {
        imageInfoEl.style.background = '#d4edda';
        imageInfoEl.style.borderLeftColor = '#28a745';
        imageInfoEl.style.color = '#155724';
      }
    }

    // é‡ç½®åæ ‡æ˜¾ç¤º
    function resetCoordinates() {
      originalSizeEl.textContent = 'åŠ è½½ä¸­...';
      displaySizeEl.textContent = 'åŠ è½½ä¸­...';
      scaleRatioEl.textContent = '-';
      browserCoordEl.textContent = 'ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹';
      originalCoordEl.textContent = 'ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹';
      clickedCoordEl.textContent = 'ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹';
      clickedOriginalCoordEl.textContent = 'ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹';
      phoneCoordEl.textContent = 'ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹';
    }

    // æ”¯æŒåœ¨è¾“å…¥æ¡†æŒ‰å›è½¦åŠ è½½å›¾ç‰‡
    document.getElementById('imageUrlInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        loadImageFromUrl();
      }
    });
  </script>
</body>
</html>
